# POC Customers Nest Kafka

POC (Proof of Concept) de una arquitectura de microservicios usando NestJS y Kafka para la gesti√≥n de clientes en una fintech.

## üèóÔ∏è Arquitectura

Este proyecto implementa una arquitectura de microservicios con comunicaci√≥n as√≠ncrona usando Apache Kafka:

## üì¶ Servicios

### 1. **Service-Customer** (`apps/service-customer/`)

- **Responsabilidad**: Gesti√≥n del ciclo de vida de clientes
- **Eventos emitidos**: `customer.onboarded`, `customer.activated`, `customer.deactivated`, `customer.promoted`
- **Eventos consumidos**: `notification.sent`
- **Puerto**: 3001

### 2. **Service-Profiling** (`apps/service-profiling/`)

- **Responsabilidad**: An√°lisis y perfilado de clientes
- **Eventos emitidos**: `customer.profiled`
- **Eventos consumidos**: `customer.onboarded`, `customer.activated`
- **Puerto**: 3002

### 3. **Service-Notifications** (`apps/service-notifications/`)

- **Responsabilidad**: Env√≠o de notificaciones (email, SMS)
- **Eventos emitidos**: `notification.sent`
- **Eventos consumidos**: `customer.onboarded`, `customer.activated`, `customer.promoted`
- **Puerto**: 3003

## üîß M√≥dulo Compartido de Kafka

### üì¶ **@shared/kafka** (`packages/shared/kafka/`)

M√≥dulo unificado de Kafka que reemplaza las implementaciones duplicadas en cada servicio:

#### üìã **Configuraci√≥n por servicio:**

```typescript
// Service-Customer
KafkaModule.forRoot({
  clientId: 'service-customer',
  groupId: 'customers-group',
  topics: {
    emit: ['customer.onboarded', 'customer.activated', 'customer.deactivated', 'customer.promoted'],
    consume: ['notification.sent']
  }
})

// Service-Profiling
KafkaModule.forRoot({
  clientId: 'service-profiling',
  groupId: 'profiling-group',
  topics: {
    emit: ['customer.profiled'],
    consume: ['customer.onboarded', 'customer.activated']
  }
})

// Service-Notifications
KafkaModule.forRoot({
  clientId: 'service-notifications',
  groupId: 'notifications-group',
  topics: {
    consume: ['customer.onboarded', 'customer.activated', 'customer.promoted']
  }
})
```

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 18+
- Docker y Docker Compose
- pnpm (recomendado) o npm

### 1. Clonar el repositorio

```bash
git clone <repository-url>
cd poc-customers-nest-kafka
```

### 2. Instalar dependencias

```bash
# Instalar dependencias del paquete compartido
cd packages/shared/kafka
npm install
npm run build

# Volver al directorio ra√≠z
cd ../../

# Instalar dependencias de todos los servicios
cd apps/service-customer && npm install && cd ../..
cd apps/service-profiling && npm install && cd ../..
cd apps/service-notifications && npm install && cd ../..
```

### 3. Iniciar Kafka con Docker

```bash
docker-compose -f docker-compose.kafka.yml up -d
```

### 4. Iniciar los servicios

```bash
# Terminal 1 - Service Customer
cd apps/service-customer
npm run start:dev

# Terminal 2 - Service Profiling
cd apps/service-profiling
npm run start:dev

# Terminal 3 - Service Notifications
cd apps/service-notifications
npm run start:dev
```

## üîÑ Flujo de Eventos

### 1. **Onboarding de Cliente**

```bash
Service-Customer ‚Üí customer.onboarded ‚Üí Service-Profiling, Service-Notifications
```

### 2. **Activaci√≥n de Cliente**

```bash
Service-Customer ‚Üí customer.activated ‚Üí Service-Profiling, Service-Notifications
```

### 3. **Promoci√≥n de Cliente**

```bash
Service-Customer ‚Üí customer.promoted ‚Üí Service-Notifications
Service-Profiling ‚Üí customer.profiled ‚Üí (otros servicios)
```

### 4. **Notificaciones**

```bash
Service-Notifications ‚Üí notification.sent ‚Üí Service-Customer
```

### Kafka UI

Acceder a la interfaz web de Kafka:

```bash
http://localhost:8080
```
